# ğŸ¤– Android Pentesting Cheatsheet

```
 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—
â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—    â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘â•šâ•â•â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â•â•â•â•šâ•â•â–ˆâ–ˆâ•”â•â•â•
â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â–ˆâ–ˆâ•— â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•”â–ˆâ–ˆâ•— â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•‘   
â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘    â–ˆâ–ˆâ•”â•â•â•â• â–ˆâ–ˆâ•”â•â•â•  â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•”â•â•â•  â•šâ•â•â•â•â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   
â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•    â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   
â•šâ•â•  â•šâ•â•â•šâ•â•  â•šâ•â•â•â•â•šâ•â•â•â•â•â• â•šâ•â•  â•šâ•â• â•šâ•â•â•â•â•â• â•šâ•â•â•šâ•â•â•â•â•â•     â•šâ•â•     â•šâ•â•â•â•â•â•â•â•šâ•â•  â•šâ•â•â•â•   â•šâ•â•   â•šâ•â•â•â•â•â•â•â•šâ•â•â•â•â•â•â•   â•šâ•â•   
```

---

## ğŸ“¦ APK Analysis

### Extract & Decompile APK
```bash
# Download APK from device
adb shell pm list packages | grep target
adb shell pm path com.target.app
adb pull /data/app/com.target.app-1/base.apk

# Decompile with apktool
apktool d app.apk -o output_folder

# Decompile to Java (jadx)
jadx app.apk -d output_java

# jadx GUI
jadx-gui app.apk
```

### APK Structure
```
app/
â”œâ”€â”€ AndroidManifest.xml    # Permissions, components
â”œâ”€â”€ classes.dex            # Compiled Java bytecode
â”œâ”€â”€ lib/                   # Native libraries (.so)
â”œâ”€â”€ res/                   # Resources
â”œâ”€â”€ assets/                # Raw files
â””â”€â”€ META-INF/              # Signatures
```

### Analyze AndroidManifest.xml
```bash
# Check for exported components
grep -E "exported=\"true\"" AndroidManifest.xml

# Check for debug mode
grep "debuggable" AndroidManifest.xml

# Check backup allowed
grep "allowBackup" AndroidManifest.xml

# List permissions
grep "uses-permission" AndroidManifest.xml
```

---

## ğŸ” Static Analysis

### Search for Secrets
```bash
# Hardcoded credentials
grep -rn "password" --include="*.java"
grep -rn "api_key" --include="*.java"
grep -rn "secret" --include="*.java"

# URLs and endpoints
grep -rn "http://" --include="*.java"
grep -rn "https://" --include="*.java"

# Firebase URLs
grep -rn "firebaseio.com" .

# AWS keys
grep -rn "AKIA" .
```

### MobSF Analysis
```bash
# Run MobSF
docker run -p 8000:8000 opensecurity/mobile-security-framework-mobsf

# Upload APK to http://localhost:8000
# Automated static analysis
```

---

## ğŸ”§ ADB Commands

### Basic Commands
```bash
# Connect to device
adb devices
adb connect 192.168.1.100:5555

# Shell access
adb shell

# Root shell (if rooted)
adb shell su

# Install/Uninstall APK
adb install app.apk
adb install -r app.apk  # Reinstall
adb uninstall com.target.app

# File operations
adb push local_file /sdcard/
adb pull /sdcard/file local_file
```

### App Data Access (Rooted)
```bash
# App data directories
adb shell
su
cd /data/data/com.target.app/

# Common sensitive locations
/data/data/com.target.app/shared_prefs/
/data/data/com.target.app/databases/
/data/data/com.target.app/files/
/data/data/com.target.app/cache/
```

### Logcat Analysis
```bash
# All logs
adb logcat

# Filter by app
adb logcat | grep -i "com.target.app"

# Filter by tag
adb logcat -s "TAG_NAME"

# Clear logs
adb logcat -c
```

---

## ğŸ¯ Frida Basics

### Setup
```bash
# Install Frida
pip install frida-tools

# Push frida-server to device
adb push frida-server /data/local/tmp/
adb shell chmod 755 /data/local/tmp/frida-server
adb shell /data/local/tmp/frida-server &
```

### Basic Commands
```bash
# List processes
frida-ps -U

# Attach to app
frida -U -f com.target.app

# Spawn with script
frida -U -f com.target.app -l script.js --no-pause

# Attach to running app
frida -U com.target.app
```

### Root Detection Bypass Script
```javascript
// frida_root_bypass.js
Java.perform(function() {
    // RootBeer bypass
    var RootBeer = Java.use("com.scottyab.rootbeer.RootBeer");
    RootBeer.isRooted.implementation = function() {
        console.log("[*] RootBeer.isRooted() bypassed");
        return false;
    };
    
    // Generic su check bypass
    var Runtime = Java.use("java.lang.Runtime");
    Runtime.exec.overload('java.lang.String').implementation = function(cmd) {
        if (cmd.indexOf("su") !== -1) {
            console.log("[*] Blocked su check: " + cmd);
            throw new Error("Permission denied");
        }
        return this.exec(cmd);
    };
});
```

### SSL Pinning Bypass Script
```javascript
// frida_ssl_bypass.js
Java.perform(function() {
    // OkHttp3 bypass
    try {
        var CertificatePinner = Java.use('okhttp3.CertificatePinner');
        CertificatePinner.check.overload('java.lang.String', 'java.util.List').implementation = function(hostname, peerCertificates) {
            console.log('[+] OkHttp3 SSL Pinning bypassed for: ' + hostname);
            return;
        };
    } catch(e) {}

    // TrustManager bypass
    var TrustManager = Java.registerClass({
        name: 'com.custom.TrustManager',
        implements: [Java.use('javax.net.ssl.X509TrustManager')],
        methods: {
            checkClientTrusted: function(chain, authType) {},
            checkServerTrusted: function(chain, authType) {},
            getAcceptedIssuers: function() { return []; }
        }
    });
});
```

---

## ğŸ”“ Objection

### Basic Usage
```bash
# Explore app
objection -g com.target.app explore

# Common commands inside objection
android hooking list activities
android hooking list services
android hooking list receivers

# SSL pinning bypass
android sslpinning disable

# Root detection bypass
android root disable

# Dump memory
memory dump all /path/to/dump

# List classes
android hooking list classes

# Search classes
android hooking search classes password

# Hook method
android hooking watch class_method com.target.app.LoginActivity.login --dump-args --dump-return
```

---

## ğŸ’¾ Data Storage Testing

### Shared Preferences
```bash
# Location
/data/data/com.target.app/shared_prefs/

# Check for sensitive data
cat /data/data/com.target.app/shared_prefs/*.xml
```

### SQLite Databases
```bash
# Location
/data/data/com.target.app/databases/

# Extract and analyze
adb pull /data/data/com.target.app/databases/app.db
sqlite3 app.db ".tables"
sqlite3 app.db "SELECT * FROM users;"
```

### External Storage
```bash
# Check /sdcard/
ls /sdcard/Android/data/com.target.app/
ls /sdcard/Download/
```

---

## ğŸŒ Network Testing

### Proxy Setup
```bash
# Set proxy via adb
adb shell settings put global http_proxy 192.168.1.100:8080

# Remove proxy
adb shell settings put global http_proxy :0
```

### Certificate Installation
```bash
# Export Burp cert as DER, convert to PEM
openssl x509 -inform DER -in cacert.der -out cacert.pem

# Get hash for cert name
openssl x509 -inform PEM -subject_hash_old -in cacert.pem | head -1
# Output: 9a5ba575

# Rename and push
mv cacert.pem 9a5ba575.0
adb push 9a5ba575.0 /sdcard/
adb shell su -c "mount -o rw,remount /system"
adb shell su -c "cp /sdcard/9a5ba575.0 /system/etc/security/cacerts/"
adb shell su -c "chmod 644 /system/etc/security/cacerts/9a5ba575.0"
adb shell su -c "reboot"
```

---

## ğŸ› ï¸ drozer

### Setup & Basic Commands
```bash
# Start drozer server on device
adb forward tcp:31415 tcp:31415

# Connect
drozer console connect

# Get app info
run app.package.info -a com.target.app

# Find attack surface
run app.package.attacksurface com.target.app

# List activities
run app.activity.info -a com.target.app

# Start activity
run app.activity.start --component com.target.app com.target.app.MainActivity

# Content providers
run app.provider.info -a com.target.app
run scanner.provider.finduris -a com.target.app
run app.provider.query content://com.target.app.provider/users
```

---

## ğŸ“‹ Android Pentesting Checklist

```markdown
â–¡ Extract and decompile APK (apktool, jadx)
â–¡ Analyze AndroidManifest.xml (permissions, exported components)
â–¡ Search for hardcoded secrets
â–¡ Check data storage (SharedPrefs, SQLite, files)
â–¡ Test network security (SSL pinning, certificate validation)
â–¡ Bypass root detection
â–¡ Bypass SSL pinning
â–¡ Test exported components (Activities, Services, Receivers)
â–¡ Test Content Providers
â–¡ Check WebView vulnerabilities
â–¡ Analyze native libraries
â–¡ Review logcat for sensitive data
```

---

## ğŸ”— Related Cheatsheets

- [iOS Pentesting](./iOS-Pentesting.md)
- [Frida Documentation](https://frida.re/docs/)
- [API Security](../API-Security/README.md)

---

**Back to Overview:** [ğŸ“± Mobile Security](./README.md)
