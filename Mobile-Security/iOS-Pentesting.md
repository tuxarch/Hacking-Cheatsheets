# ğŸ iOS Pentesting Cheatsheet

```
â–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—
â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â•â•â•    â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘â•šâ•â•â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â•â•â•â•šâ•â•â–ˆâ–ˆâ•”â•â•â•
â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•”â–ˆâ–ˆâ•— â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•‘   
â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â•šâ•â•â•â•â–ˆâ–ˆâ•‘    â–ˆâ–ˆâ•”â•â•â•â• â–ˆâ–ˆâ•”â•â•â•  â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•”â•â•â•  â•šâ•â•â•â•â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   
â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘    â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   
â•šâ•â• â•šâ•â•â•â•â•â• â•šâ•â•â•â•â•â•â•    â•šâ•â•     â•šâ•â•â•â•â•â•â•â•šâ•â•  â•šâ•â•â•â•   â•šâ•â•   â•šâ•â•â•â•â•â•â•â•šâ•â•â•â•â•â•â•   â•šâ•â•   
```

---

## ğŸ“¦ IPA Analysis

### Extract IPA from Device
```bash
# Using ipatool (App Store)
ipatool download -b com.target.app -o app.ipa

# From jailbroken device
ssh root@DEVICE_IP
find /var/containers/Bundle/Application -name "*.app"
# Copy the .app bundle and zip it as .ipa

# Using frida-ios-dump
python dump.py com.target.app
```

### IPA Structure
```
Payload/
â””â”€â”€ App.app/
    â”œâ”€â”€ Info.plist           # App configuration
    â”œâ”€â”€ App (binary)         # Main executable
    â”œâ”€â”€ Frameworks/          # Embedded frameworks
    â”œâ”€â”€ _CodeSignature/      # Code signing
    â””â”€â”€ *.storyboardc        # UI files
```

### Static Analysis
```bash
# Extract IPA
unzip app.ipa -d extracted/

# Analyze Info.plist
plutil -p Payload/App.app/Info.plist

# Check for ATS (App Transport Security) exceptions
grep -A 5 "NSAppTransportSecurity" Info.plist

# Check URL schemes
grep -A 10 "CFBundleURLTypes" Info.plist

# Binary analysis
otool -L Payload/App.app/App          # Libraries
otool -l Payload/App.app/App | grep -A 5 LC_ENCRYPTION_INFO  # Encryption
strings Payload/App.app/App | grep -i "password\|api\|key\|secret"
```

---

## ğŸ”§ Device Setup

### Jailbreak Tools
| iOS Version | Tool |
|-------------|------|
| iOS 14-15 | unc0ver, Taurine |
| iOS 15-16 | Dopamine, palera1n |
| iOS 17+ | palera1n (A8-A11) |

### Essential Cydia Packages
```
- OpenSSH
- Filza File Manager
- AppSync Unified
- Frida
- SSL Kill Switch 2
- Liberty Lite (jailbreak detection bypass)
```

### SSH to Device
```bash
# Default credentials: root/alpine
ssh root@DEVICE_IP

# Change default password!
passwd
```

---

## ğŸ¯ Frida on iOS

### Setup
```bash
# Install Frida on device (via Cydia or manually)
# Add repo: https://build.frida.re

# Or manually
scp frida-server root@DEVICE_IP:/usr/local/bin/
ssh root@DEVICE_IP chmod +x /usr/local/bin/frida-server
```

### Basic Commands
```bash
# List apps
frida-ps -Ua

# Attach to app
frida -U -f com.target.app

# Spawn with script
frida -U -f com.target.app -l script.js --no-pause
```

### Jailbreak Detection Bypass Script
```javascript
// frida_jb_bypass.js
if (ObjC.available) {
    try {
        var paths = [
            "/Applications/Cydia.app",
            "/Library/MobileSubstrate/MobileSubstrate.dylib",
            "/bin/bash",
            "/usr/sbin/sshd",
            "/etc/apt",
            "/private/var/lib/apt/"
        ];
        
        var fileManager = ObjC.classes.NSFileManager.defaultManager();
        
        Interceptor.attach(fileManager["- fileExistsAtPath:"].implementation, {
            onEnter: function(args) {
                var path = ObjC.Object(args[2]).toString();
                if (paths.indexOf(path) !== -1) {
                    console.log("[*] Blocked fileExistsAtPath: " + path);
                }
            },
            onLeave: function(retval) {
                retval.replace(0);
            }
        });
    } catch(e) {}
}
```

### SSL Pinning Bypass Script
```javascript
// frida_ssl_ios.js
if (ObjC.available) {
    // NSURLSession bypass
    var NSURLSession = ObjC.classes.NSURLSession;
    
    Interceptor.attach(ObjC.classes.NSURLSessionConfiguration['- setHTTPAdditionalHeaders:'].implementation, {
        onEnter: function(args) {
            console.log("[*] SSL Pinning bypass engaged");
        }
    });
    
    // SecTrustEvaluate bypass
    var SecTrustEvaluate = Module.findExportByName("Security", "SecTrustEvaluate");
    if (SecTrustEvaluate) {
        Interceptor.attach(SecTrustEvaluate, {
            onLeave: function(retval) {
                retval.replace(0);  // errSecSuccess
            }
        });
    }
}
```

---

## ğŸ”“ Objection (iOS)

### Basic Usage
```bash
# Explore app
objection -g com.target.app explore

# Common commands
ios info binary
ios plist cat Info.plist
ios keychain dump
ios nsuserdefaults get
ios cookies get

# SSL pinning bypass
ios sslpinning disable

# Jailbreak detection bypass
ios jailbreak disable

# Dump classes
ios hooking list classes

# Search classes
ios hooking search classes Password

# Watch method
ios hooking watch method "+[KeychainWrapper getPassword]" --dump-args --dump-return
```

---

## ğŸ’¾ Data Storage Testing

### Keychain
```bash
# Using objection
ios keychain dump

# Using keychain-dumper (jailbroken)
./keychain-dumper

# Check keychain items
security dump-keychain -d
```

### NSUserDefaults
```bash
# Using objection
ios nsuserdefaults get

# Manual location
/var/mobile/Containers/Data/Application/APP-UUID/Library/Preferences/com.target.app.plist
```

### Local Files
```bash
# App data directory
/var/mobile/Containers/Data/Application/APP-UUID/

# Important locations
Documents/
Library/Caches/
Library/Preferences/
tmp/

# SQLite databases
find /var/mobile/Containers/Data/Application -name "*.db" -o -name "*.sqlite"
```

### Core Data / Realm
```bash
# Find databases
find . -name "*.realm" -o -name "*.sqlite"

# Use sqlite3 or Realm Browser
sqlite3 database.sqlite ".tables"
sqlite3 database.sqlite "SELECT * FROM USERS;"
```

---

## ğŸŒ Network Testing

### Proxy Setup
```
Settings > Wi-Fi > [Network] > Configure Proxy > Manual
Server: Your-IP
Port: 8080
```

### Install Burp Certificate
```bash
# Export Burp cert
# Send to device via AirDrop/email

# On device:
Settings > General > VPN & Device Management > Install profile

# Trust certificate
Settings > General > About > Certificate Trust Settings > Enable
```

### SSL Kill Switch 2
```bash
# Install from Cydia
# Enable in Settings > SSL Kill Switch 2

# Bypasses SSL pinning for all apps
```

---

## ğŸ” Binary Analysis

### Check Security Features
```bash
# PIE (Position Independent Executable)
otool -hv App | grep PIE

# Stack Canaries
otool -I -v App | grep stack_chk

# ARC (Automatic Reference Counting)
otool -I -v App | grep objc_release

# Encryption
otool -l App | grep -A 5 LC_ENCRYPTION_INFO
# cryptid = 1 means encrypted (need to decrypt)
```

### Decrypt Binary
```bash
# Using frida-ios-dump (recommended)
python dump.py -H 192.168.1.10 -p 22 com.target.app

# Using Clutch (older method)
Clutch -d com.target.app

# Using dumpdecrypted
DYLD_INSERT_LIBRARIES=dumpdecrypted.dylib /var/containers/Bundle/Application/.../App.app/App
```

### Class-dump
```bash
# Dump Objective-C headers
class-dump-z App > headers.h

# Or using dsdump
dsdump --objc App
```

---

## ğŸ› ï¸ Useful Tools

| Tool | Purpose |
|------|---------|
| **Frida** | Dynamic instrumentation |
| **Objection** | Runtime exploration |
| **Hopper/IDA** | Disassembly |
| **Ghidra** | Reverse engineering |
| **MobSF** | Automated analysis |
| **ipatool** | Download from App Store |
| **Filza** | File manager (device) |
| **Cycript** | Runtime manipulation |

---

## ğŸ“‹ iOS Pentesting Checklist

```markdown
â–¡ Extract and decrypt IPA
â–¡ Analyze Info.plist (ATS, URL schemes)
â–¡ Check binary protections (PIE, stack canaries)
â–¡ Dump and analyze Keychain
â–¡ Check NSUserDefaults
â–¡ Search for local databases (SQLite, Realm)
â–¡ Test SSL pinning
â–¡ Bypass jailbreak detection
â–¡ Test deep links / URL schemes
â–¡ Check for sensitive data in logs
â–¡ Analyze network traffic
â–¡ Test clipboard leakage
â–¡ Check screenshot prevention
```

---

## ğŸ”— Related Cheatsheets

- [Android Pentesting](./Android-Pentesting.md)
- [Frida Documentation](https://frida.re/docs/)
- [API Security](../API-Security/README.md)

---

**Back to Overview:** [ğŸ“± Mobile Security](./README.md)
